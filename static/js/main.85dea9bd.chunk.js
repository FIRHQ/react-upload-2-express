(this["webpackJsonpreact-upload-2-express-example"]=this["webpackJsonpreact-upload-2-express-example"]||[]).push([[0],{12:function(e,t,n){"use strict";n.r(t);n(7);var i=n(0),o=n.n(i),l=n(2),a=n.n(l),u=n(3),c=n(4),d=n(5);function r(){return(r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}var s=function(e,t){e&&(e.style.display=t?"":"none")},m=function(){function e(t){var n=t.uploadPanel,i=t.projectId,o=t.domain,l=void 0===o?"uploadhelper.ce04.com":o,a=t.imgElement,u=void 0===a?null:a,d=t.qrImgElement,r=void 0===d?null:d,s=t.qrcodeWidth,m=void 0===s?200:s,p=t.imgMaxWidth,h=void 0===p?200:p,v=t.imgMaxHeight,g=void 0===v?200:v;Object(c.a)(this,e),this.uploadPanel=n,this.projectId=i,this.domain=l,this.imgElement=u||n.querySelector(".img"),null==this.imgElement&&(this.imgElement=document.createElement("img"),this.imgElement.className="img",this.imgElement.style.cssText="max-width: ".concat(h,"px;max-height: ").concat(g,";display:none"),this.uploadPanel.appendChild(this.imgElement)),this.qrImgElement=r||n.querySelector(".qrcodeImg"),null==this.qrImgElement&&(this.qrImgElement=document.createElement("img"),this.qrImgElement.className="qrcodeImg",this.qrImgElement.style.cssText="width: ".concat(m,"px;height: ").concat(m,"px;display:none"),this.uploadPanel.appendChild(this.qrImgElement))}return Object(d.a)(e,[{key:"bindAllElement",value:function(e){var t=this,n=e.qrcodeBtn,i=e.linkBtn,o=e.userId,l=e.uid,a=e.fetchSecretPromise,u=void 0===a?null:a,c=e.mainAttribute,d=void 0===c?null:c,r=e.secondAttribute,m=void 0===r?null:r,h=e.updateFunction,g=void 0===h?function(e){console.log("img updated: ".concat(e))}:h,f=u;null==f&&(f=Promise.resolve(null)),f.then((function(e){n&&(n.onclick=function(n){n.preventDefault(),s(t.qrImgElement,!0),t.qrImgElement.src=v(t.projectId,o,l,d,m,e,t.domain),t.bindImgLoad({userId:o,uid:l,updateFunction:g})}),i&&(i.onclick=function(n){s(t.qrImgElement,!1),t.bindImgLoad({userId:o,uid:l,updateFunction:g});var i=p(t.projectId,o,l,d,m,e,t.domain);window.open(i)})}))}},{key:"bindImgLoad",value:function(e){var t=this,n=e.userId,i=e.uid,o=e.updateFunction,l=h(this.projectId,n,i,this.domain);!function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e){};e.src=t,e.onerror=function(){s(e,!1),setTimeout((function(){e.src="".concat(t,"&t=").concat((new Date).getTime())}),3e3)},e.onload=function(){s(e,!0),n(t)}}(this.imgElement,l,(function(e){s(t.qrImgElement,!1),o(e)}))}},{key:"uploadByBrowser",value:function(e){var t=e.userId,n=void 0===t?-1:t,i=e.uid,o=e.secret,l=void 0===o?null:o,a=e.mainAttribute,u=void 0===a?null:a,c=e.secondAttribute,d=void 0===c?null:c,r=e.updateFunction;s(this.qrImgElement,!1),this.bindImgLoad({userId:n,uid:i,updateFunction:r});var m=p(this.projectId,n,i,u,d,l,this.domain);window.open(m)}},{key:"uploadByQrScan",value:function(e){var t=e.userId,n=void 0===t?-1:t,i=e.uid,o=e.secret,l=void 0===o?null:o,a=e.mainAttribute,u=void 0===a?null:a,c=e.secondAttribute,d=void 0===c?null:c,r=e.updateFunction;s(this.qrImgElement,!0),this.qrImgElement.src=v(this.projectId,n,i,u,d,l,this.domain),this.bindImgLoad({userId:n,uid:i,updateFunction:r})}}]),e}(),p=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"https://uploadhelper.ce04.com",u="".concat(a,"/projects/").concat(e,"/standard_images/new?client_user_uid=").concat(t,"&upload_uid=").concat(n,"&main_attribute=").concat(i,"&second_attribute=").concat(o);return l&&(u="".concat(u,"&secret=").concat(l)),u},h=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"https://uploadhelper.ce04.com";return"".concat(i,"/fetch_image?project_id=").concat(e,"&client_user_id=").concat(t,"&upload_uid=").concat(n)},v=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"https://uploadhelper.ce04.com";return"".concat(a,"/welcome/qrcode?url=").concat(encodeURIComponent(p(e,t,n,i,o,l,a)))},g=function(e){var t=e.projectId,n=e.children,l=e.domain,a=void 0===l?"https://uploadhelper.ce04.com":l,u=e.userId,c=void 0===u?"default":u,d=e.uid,s=void 0===d?null:d,p=e.showLink,h=void 0===p||p,v=e.panelClass,g=void 0===v?null:v,f=e.directLinkClass,I=void 0===f?null:f,E=e.defaultUploadedUrl,b=void 0===E?null:E,y=e.showDirectLink,q=void 0===y||y,j=e.qrCodeLinkClass,w=void 0===j?null:j,k=e.showQrCodeLink,x=void 0===k||k,F=e.RenderDom,_=void 0===F?null:F,L=e.showUploadedImg,O=void 0===L||L,C=e.uploadedImgStyle,B=void 0===C?{}:C,S=e.buildUidFunc,D=void 0===S?function(){return(new Date).getTime()}:S,P=e.updatedFunc,A=void 0===P?function(e){}:P,N=Object(i.useRef)(null),R=Object(i.useRef)(null),T=Object(i.useState)(b),U=T[0],Q=T[1],W=Object(i.useState)(!1),H=W[0],J=W[1],M=null,z=function(){return s||D()};Object(i.useEffect)((function(){M=new m({uploadPanel:N.current,projectId:t,qrcodeWidth:160,domain:a})}),[]);return o.a.createElement("div",null,o.a.createElement("div",{ref:N},o.a.createElement("div",{className:g+" upload-panel-buttons"},q?o.a.createElement("a",{href:"#",className:I+" direct-upload-link",onClick:function(e){e.preventDefault(),M.uploadByBrowser({userId:c,uid:z(),updateFunction:function(e){A(e),Q(e),J(!0)}})}},"\u4e0a\u4f20\u56fe\u7247"):null,x?o.a.createElement("a",{href:"#",className:w+" qr-upload-link ",onClick:function(e){e.preventDefault(),M.uploadByQrScan({userId:c,uid:z(),updateFunction:function(e){A(e),Q(e),J(!0)}})}},"\u901a\u8fc7\u624b\u673a\u4e0a\u4f20\u56fe\u7247"):null),o.a.createElement("img",{ref:R,className:"img",style:r({},{objectFit:"contain",maxidth:200,maxHeight:200,display:H||!O?"":"hidden"},{uploadedImgStyle:B})})),h&&H?o.a.createElement("a",{href:U},U):null,_&&U?o.a.createElement(_,{url:U}):null,n)},f=function(e){var t=e.url;return o.a.createElement(o.a.Fragment,null,o.a.createElement("input",{type:"hidden",value:t,name:"user[profile_image_url]"}))},I=function(e){return Object(u.a)(e),o.a.createElement(o.a.Fragment,null,o.a.createElement(g,{projectId:"user_avatar",showLink:!0,RenderDom:f}))};a.a.render(o.a.createElement(I,null),document.getElementById("root"))},6:function(e,t,n){e.exports=n(12)},7:function(e,t,n){}},[[6,1,2]]]);
//# sourceMappingURL=main.85dea9bd.chunk.js.map